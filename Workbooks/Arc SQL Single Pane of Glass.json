{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "Arc SQL Single Pane of Glass",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "workbook",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "azure monitor",
      "metadata": {
        "description": "The id of resource instance to which the workbook will be associated"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    },
    "licensingWorkbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The resource Id for the SQL Licensing Summary Workbook"
      }
    }
  },
  "variables": {
    "templatePart1": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"b1c3ecb9-4ef5-4e40-90cd-29058976589d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"View\",\"type\":11,\"typeSettings\":{\"additionalResourceOptions\":[]},\"jsonData\":\"[\\r\\n    {\\\"value\\\": \\\"general\\\", \\\"label\\\": \\\"General\\\"},\\r\\n    {\\\"value\\\": \\\"bpa\\\", \\\"label\\\": \\\"Best Practices Assessment\\\"},\\r\\n    {\\\"value\\\": \\\"licensing\\\", \\\"label\\\": \\\"Licensing\\\"},\\r\\n    {\\\"value\\\": \\\"perf\\\", \\\"label\\\": \\\"Performance\\\"},\\r\\n    {\\\"value\\\": \\\"security\\\", \\\"label\\\": \\\"Security\\\"},\\r\\n    {\\\"value\\\": \\\"backups\\\", \\\"label\\\": \\\"Backups\\\"}\\r\\n]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"perf\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 0\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"General Information\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n\\t| where type =~ 'Microsoft.Sql/servers' or type == 'microsoft.azurearcdata/sqlserverinstances' or type == 'microsoft.sql/managedinstances'\\r\\n\\t| extend propertiesState = tostring(properties.state)\\r\\n\\t| extend propertiesStatus = tostring(properties.status)\\r\\n\\t| extend version = tostring(properties.currentVersion )\\r\\n\\t| extend patch = properties.patchlevel\\r\\n\\t| extend vcore = tostring(properties.vCore)\\r\\n\\t| extend license = tostring(properties.licenseType)\\r\\n\\t| extend vcores = tostring(properties.vCores)\\r\\n\\t| extend SQLversion = case( substring(version, 0, 2) == \\\"16\\\", \\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tcase(substring(properties.patchLevel,5,4) == \\\"4015\\\", \\\"SQL 2022 (CU2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4003\\\", \\\"SQL 2022 (CU1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"1000\\\", \\\"SQL 2022 (RTM)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tisempty(properties.patchlevel), \\\"\\\", \\\"Unknown\\\") ,\\r\\n\\t\\t\\t\\t\\t\\t\\t\\tsubstring(version, 0, 2) == \\\"15\\\", \\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tcase( substring(properties.patchLevel,5,4) == \\\"4298\\\", \\\"SQL 2019 (CU19)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4261\\\", \\\"SQL 2019 (CU18)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4249\\\", \\\"SQL 2019 (CU17)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4223\\\", \\\"SQL 2019 (CU16)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4198\\\", \\\"SQL 2019 (CU15)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4188\\\", \\\"SQL 2019 (CU14)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4178\\\", \\\"SQL 2019 (CU13)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4153\\\", \\\"SQL 2019 (CU12)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4138\\\", \\\"SQL 2019 (CU11)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4123\\\", \\\"SQL 2019 (CU10)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4102\\\", \\\"SQL 2019 (CU9)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4083\\\", \\\"SQL 2019 (CU8 w/SU)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4073\\\", \\\"SQL 2019 (CU8)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4063\\\", \\\"SQL 2019 (CU7)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4053\\\", \\\"SQL 2019 (CU6)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4043\\\", \\\"SQL 2019 (CU5)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4033\\\", \\\"SQL 2019 (CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4023\\\", \\\"SQL 2019 (CU3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4013\\\", \\\"SQL 2019 (CU2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4003\\\", \\\"SQL 2019 (CU1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2000\\\", \\\"SQL 2019 (RTM)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tisempty(substring(properties.patchLevel,5,4)), \\\"\\\", \\\"Unknown\\\"),\\r\\n\\t\\t\\t\\t\\t\\t\\t\\tsubstring(version, 0, 2) == \\\"14\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tcase( substring(properties.patchLevel,5,4) == \\\"3456\\\", \\\"SQL 2017 (CU31)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3451\\\", \\\"SQL 2017 (CU30)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3436\\\", \\\"SQL 2017 (CU29)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3430\\\", \\\"SQL 2017 (CU28)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3421\\\", \\\"SQL 2017 (CU27\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3411\\\", \\\"SQL 2017 (CU26)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3401\\\", \\\"SQL 2017 (CU25)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3391\\\", \\\"SQL 2017 (CU24)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3381\\\", \\\"SQL 2017 (CU23)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3356\\\", \\\"SQL 2017 (CU22)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3335\\\", \\\"SQL 2017 (CU21)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3294\\\", \\\"SQL 2017 (CU20)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3281\\\", \\\"SQL 2017 (CU19)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3257\\\", \\\"SQL 2017 (CU18)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3238\\\", \\\"SQL 2017 (CU17)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3223\\\", \\\"SQL 2017 (CU16)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3162\\\", \\\"SQL 2017 (CU15)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3076\\\", \\\"SQL 2017 (CU14)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3048\\\", \\\"SQL 2017 (CU13)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3045\\\", \\\"SQL 2017 (CU12)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3038\\\", \\\"SQL 2017 (CU11)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3037\\\", \\\"SQL 2017 (CU10)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3030\\\", \\\"SQL 2017 (CU9)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3029\\\", \\\"SQL 2017 (CU8)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3026\\\", \\\"SQL 2017 (CU7)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3025\\\", \\\"SQL 2017 (CU6)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3023\\\", \\\"SQL 2017 (CU5)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3022\\\", \\\"SQL 2017 (CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3015\\\", \\\"SQL 2017 (CU3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3008\\\", \\\"SQL 2017 (CU2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"3006\\\", \\\"SQL 2017 (CU1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"1000\\\", \\\"SQL 2017 (RTM)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tisempty(properties.patchLevel), \\\"\\\", \\\"Unknown\\\"),\\r\\n\\t\\t\\t\\t\\t\\t\\t\\tsubstring(version, 0, 2) == \\\"13\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tcase( substring(properties.patchLevel,5,4) == \\\"7024\\\", \\\"SQL 2016 (SP3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"7016\\\", \\\"SQL 2016 (SP3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"7000\\\", \\\"SQL 2016 (SP3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6430\\\", \\\"SQL 2016 (SP3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6419\\\", \\\"SQL 2016 (SP3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6404\\\", \\\"SQL 2016 (SP3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6300\\\", \\\"SQL 2016 (SP3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5893\\\", \\\"SQL 2016 (SP2 CU17)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5888\\\", \\\"SQL 2016 (SP2 CU17)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5882\\\", \\\"SQL 2016 (SP2 CU16)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5865\\\", \\\"SQL 2016 (SP2 CU15)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5850\\\", \\\"SQL 2016 (SP2 CU15)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5830\\\", \\\"SQL 2016 (SP2 CU14)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5820\\\", \\\"SQL 2016 (SP2 CU13)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5698\\\", \\\"SQL 2016 (SP2 CU12)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5622\\\", \\\"SQL 2016 (SP2 CU11)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5698\\\", \\\"SQL 2016 (SP2 CU11)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5492\\\", \\\"SQL 2016 (SP2 CU10)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5479\\\", \\\"SQL 2016 (SP2 CU9)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5426\\\", \\\"SQL 2016 (SP2 CU8)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5382\\\", \\\"SQL 2016 (SP2 CU7)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5366\\\", \\\"SQL 2016 (SP2 CU7)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5343\\\", \\\"SQL 2016 (SP2 CU7)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5337\\\", \\\"SQL 2016 (SP2 CU7)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5292\\\", \\\"SQL 2016 (SP2 CU6)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5270\\\", \\\"SQL 2016 (SP2 CU5)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5264\\\", \\\"SQL 2016 (SP2 CU5)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5239\\\", \\\"SQL 2016 (SP2 CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5233\\\", \\\"SQL 2016 (SP2 CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5221\\\", \\\"SQL 2016 (SP2 CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5216\\\", \\\"SQL 2016 (SP2 CU3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5201\\\", \\\"SQL 2016 (SP2 CU3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5161\\\", \\\"SQL 2016 (SP2 CU3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5153\\\", \\\"SQL 2016 (SP2 CU2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5149\\\", \\\"SQL 2016 (SP2 CU1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5108\\\", \\\"SQL 2016 (SP2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5103\\\", \\\"SQL 2016 (SP2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5102\\\", \\\"SQL 2016 (SP2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5101\\\", \\\"SQL 2016 (SP2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5081\\\", \\\"SQL 2016 (SP2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5026\\\", \\\"SQL 2016 (SP2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4604\\\", \\\"SQL 2016 (SP1 CU15)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4577\\\", \\\"SQL 2016 (SP1 CU15)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4574\\\", \\\"SQL 2016 (SP1 CU15)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4560\\\", \\\"SQL 2016 (SP1 CU14)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4550\\\", \\\"SQL 2016 (SP1 CU13)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4541\\\", \\\"SQL 2016 (SP1 CU12)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4531\\\", \\\"SQL 2016 (SP1 CU12)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4528\\\", \\\"SQL 2016 (SP1 CU11)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4522\\\", \\\"SQL 2016 (SP1 CU10)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4514\\\", \\\"SQL 2016 (SP1 CU10)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4502\\\", \\\"SQL 2016 (SP1 CU9)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4477\\\", \\\"SQL 2016 (SP1 CU8)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4474\\\", \\\"SQL 2016 (SP1 CU8)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4466\\\", \\\"SQL 2016 (SP1 CU7)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4457\\\", \\\"SQL 2016 (SP1 CU6)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4451\\\", \\\"SQL 2016 (SP1 CU5)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4446\\\", \\\"SQL 2016 (SP1 CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4435\\\", \\\"SQL 2016 (SP1 CU3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4422\\\", \\\"SQL 2016 (SP1 CU2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4411\\\", \\\"SQL 2016 (SP1 CU1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4259\\\", \\\"SQL 2016 (SP1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4224\\\", \\\"SQL 2016 (SP1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4223\\\", \\\"SQL 2016 (SP1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4210\\\", \\\"SQL 2016 (SP1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4206\\\", \\\"SQL 2016 (SP1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4202\\\", \\\"SQL 2016 (SP1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4199\\\", \\\"SQL 2016 (SP1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4001\\\", \\\"SQL 2016 (SP1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2218\\\", \\\"SQL 2016 (SP1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2216\\\", \\\"SQL 2016 (SP1 CU9)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2213\\\", \\\"SQL 2016 (SP1 CU8)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2210\\\", \\\"SQL 2016 (SP1 CU7)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2204\\\", \\\"SQL 2016 (SP1 CU6)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2197\\\", \\\"SQL 2016 (SP1 CU5)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2193\\\", \\\"SQL 2016 (SP1 CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2190\\\", \\\"SQL 2016 (SP1 CU3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2186\\\", \\\"SQL 2016 (SP1 CU3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2170\\\", \\\"SQL 2016 (SP1 CU2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2169\\\", \\\"SQL 2016 (SP1 CU2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2264\\\", \\\"SQL 2016 (SP1 CU2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2149\\\", \\\"SQL 2016 (SP1 CU1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"1745\\\", \\\"SQL 2016 (RTM)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"1742\\\", \\\"SQL 2016 (RTM)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"1728\\\", \\\"SQL 2016 (RTM)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"1722\\\", \\\"SQL 2016 (RTM)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"1711\\\", \\\"SQL 2016 (RTM)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"1708\\\", \\\"SQL 2016 (RTM)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"1601\\\", \\\"SQL 2016 (RTM)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tisempty(properties.patchLevel), \\\"\\\", \\\"Unknown\\\"),\\r\\n\\t\\t\\t\\t\\t\\t\\t\\tsubstring(version, 0, 2) == \\\"12\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\tcase( substring(properties.patchLevel,5,4) == \\\"6444\\\", \\\"SQL 2014 (SP3 CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6439\\\", \\\"SQL 2014 (SP3 CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6433\\\", \\\"SQL 2014 (SP3 CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6372\\\", \\\"SQL 2014 (SP3 CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6329\\\", \\\"SQL 2014 (SP3 CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6259\\\", \\\"SQL 2014 (SP3 CU3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6214\\\", \\\"SQL 2014 (SP3 CU2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6205\\\", \\\"SQL 2014 (SP3 CU2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6174\\\", \\\"SQL 2014 (SP3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6169\\\", \\\"SQL 2014 (SP3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6164\\\", \\\"SQL 2014 (SP3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6118\\\", \\\"SQL 2014 (SP3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6108\\\", \\\"SQL 2014 (SP3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"6024\\\", \\\"SQL 2014 (SP3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5687\\\", \\\"SQL 2014 (SP2 CU18)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5659\\\", \\\"SQL 2014 (SP2 CU17)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5632\\\", \\\"SQL 2014 (SP2 CU17)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5626\\\", \\\"SQL 2014 (SP2 CU16)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5605\\\", \\\"SQL 2014 (SP2 CU15)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5600\\\", \\\"SQL 2014 (SP2 CU14)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5590\\\", \\\"SQL 2014 (SP2 CU13)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5589\\\", \\\"SQL 2014 (SP2 CU12)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5579\\\", \\\"SQL 2014 (SP2 CU11)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5571\\\", \\\"SQL 2014 (SP2 CU10)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5563\\\", \\\"SQL 2014 (SP2 CU9)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5557\\\", \\\"SQL 2014 (SP2 CU8)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5556\\\", \\\"SQL 2014 (SP2 CU7)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5553\\\", \\\"SQL 2014 (SP2 CU6)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5546\\\", \\\"SQL 2014 (SP2 CU5)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5540\\\", \\\"SQL 2014 (SP2 CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5538\\\", \\\"SQL 2014 (SP2 CU3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5532\\\", \\\"SQL 2014 (SP2 CU2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5522\\\", \\\"SQL 2014 (SP2 CU2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5511\\\", \\\"SQL 2014 (SP2 CU1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5223\\\", \\\"SQL 2014 (SP2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5214\\\", \\\"SQL 2014 (SP2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5207\\\", \\\"SQL 2014 (SP2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5203\\\", \\\"SQL 2014 (SP2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"5000\\\", \\\"SQL 2014 (SP2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4522\\\", \\\"SQL 2014 (SP1 CU13)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4522\\\", \\\"SQL 2014 (SP1 CU13)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4511\\\", \\\"SQL 2014 (SP1 CU12)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4502\\\", \\\"SQL 2014 (SP1 CU11)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4491\\\", \\\"SQL 2014 (SP1 CU10)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4487\\\", \\\"SQL 2014 (SP1 CU9)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4474\\\", \\\"SQL 2014 (SP1 CU9)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4468\\\", \\\"SQL 2014 (SP1 CU8)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4463\\\", \\\"SQL 2014 (SP1 CU7)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4459\\\", \\\"SQL 2014 (SP1 CU7)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4457\\\", \\\"SQL 2014 (SP1 CU6)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4449\\\", \\\"SQL 2014 (SP1 CU6)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4439\\\", \\\"SQL 2014 (SP1 CU5)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4437\\\", \\\"SQL 2014 (SP1 CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4436\\\", \\\"SQL 2014 (SP1 CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4433\\\", \\\"SQL 2014 (SP1 CU3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4432\\\", \\\"SQL 2014 (SP1 CU3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4427\\\", \\\"SQL 2014 (SP1 CU3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4422\\\", \\\"SQL 2014 (SP1 CU2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4419\\\", \\\"SQL 2014 (SP1 CU1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4416\\\", \\\"SQL 2014 (SP1 CU1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4219\\\", \\\"SQL 2014 (SP1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4213\\\", \\\"SQL 2014 (SP1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4100\\\", \\\"SQL 2014 (SP1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"4050\\\", \\\"SQL 2014 (SP1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2569\\\", \\\"SQL 2014 (RTM CU14)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2568\\\", \\\"SQL 2014 (RTM CU13)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2564\\\", \\\"SQL 2014 (RTM CU12)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2560\\\", \\\"SQL 2014 (RTM CU11)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2556\\\", \\\"SQL 2014 (RTM CU10)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2553\\\", \\\"SQL 2014 (RTM CU9)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2548\\\", \\\"SQL 2014 (RTM CU8)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2546\\\", \\\"SQL 2014 (RTM CU8)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2506\\\", \\\"SQL 2014 (RTM CU7)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2505\\\", \\\"SQL 2014 (RTM CU7)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2504\\\", \\\"SQL 2014 (RTM CU7)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2495\\\", \\\"SQL 2014 (RTM CU7)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2488\\\", \\\"SQL 2014 (RTM CU6)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2485\\\", \\\"SQL 2014 (RTM CU6)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2488\\\", \\\"SQL 2014 (RTM CU6)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2485\\\", \\\"SQL 2014 (RTM CU6)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2480\\\", \\\"SQL 2014 (RTM CU6)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2474\\\", \\\"SQL 2014 (RTM CU5)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2472\\\", \\\"SQL 2014 (RTM CU5)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2464\\\", \\\"SQL 2014 (RTM CU5)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2456\\\", \\\"SQL 2014 (RTM CU5)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2436\\\", \\\"SQL 2014 (RTM CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2430\\\", \\\"SQL 2014 (RTM CU4)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2423\\\", \\\"SQL 2014 (RTM CU3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2405\\\", \\\"SQL 2014 (RTM CU3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2402\\\", \\\"SQL 2014 (RTM CU3)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2381\\\", \\\"SQL 2014 (RTM CU2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2370\\\", \\\"SQL 2014 (RTM CU2)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2342\\\", \\\"SQL 2014 (RTM CU1)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2271\\\", \\\"SQL 2014 (RTM)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2269\\\", \\\"SQL 2014 (RTM)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2254\\\", \\\"SQL 2014 (RTM)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tsubstring(properties.patchLevel,5,4) == \\\"2000\\\", \\\"SQL 2014 (RTM)\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tisempty(properties.patchLevel), \\\"\\\", \\\"Unknown\\\"),\\r\\n\\t\\t\\t\\t\\t\\t\\t\\tsubstring(version, 0, 2) == \\\"11\\\", \\\"SQL 2012\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\tsubstring(version, 0, 2) == \\\"11\\\", \\\"SQL 2008 R2\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\t\\tisempty(propertiesState), \\\"\\\",    \\\"Unknown\\\")\\r\\n\\t| extend edition = tostring(properties.edition)\\t\\r\\n\\t| extend state = case(    propertiesState == \\\"Degraded\\\", \\\"Degraded\\\",    \\r\\n\\t\\t\\t\\t\\t\\t\\t  propertiesState == \\\"Warned\\\", \\\"Warned\\\",    \\r\\n\\t\\t\\t\\t\\t\\t\\t  propertiesState == \\\"Disabled\\\", \\\"Disabled\\\",    \\r\\n\\t\\t\\t\\t\\t\\t\\t  propertiesState == \\\"Ready\\\", \\\"Available\\\",    \\r\\n\\t\\t\\t\\t\\t\\t\\t  propertiesState == \\\"Reserved\\\", \\\"Reserved\\\",  \\r\\n\\t\\t\\t\\t\\t\\t\\t  propertiesStatus == \\\"Connected\\\", \\\"Connected\\\",  \\r\\n\\t\\t\\t\\t\\t\\t\\t  isempty(propertiesState), \\\"\\\",    \\\"Unknown\\\")\\r\\n    | extend type = case(     ['type'] == \\\"microsoft.sql/servers\\\", \\\"Azure SQL\\\",\\r\\n                              ['type'] == \\\"microsoft.sql/managedinstances\\\", \\\"SQL MI\\\",\\r\\n                              ['type'] == \\\"microsoft.azurearcdata/sqlserverinstances\\\", \\\"Arc SQL\\\",\\r\\n                              isempty(['type']), \\\"\\\",    \\\"Unknown\\\")\\r\\n\\t| extend Cores = case (   vcore != \\\"\\\", tostring(vcore), \\r\\n\\t\\t\\t\\t\\t\\t\\t  vcores != \\\"\\\", tostring(vcores),\\r\\n\\t\\t\\t\\t\\t\\t\\t  isempty(propertiesState), \\\"\\\",    \\\"N/A\\\")\\r\\n\\t| project id, name, [\\\"Type\\\"] = type, [\\\"Version\\\"] = SQLversion,  [\\\"Edition\\\"] = edition, [\\\"L-Type\\\"] = license, Cores //id, \",\"size\":0,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"]},\"name\":\"query - 0\"}]},\"conditionalVisibility\":{\"parameterName\":\"View\",\"comparison\":\"isEqualTo\",\"value\":\"general\"},\"name\":\"General\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Best Practices Assessment\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"value::all\"],\"parameters\":[{\"id\":\"292136e8-a3e4-4095-8511-d3932fab2224\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"bpala\",\"label\":\"Best Practices Assessment Log Analytics Workspace\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"resources\\r\\n| where type == \\\"microsoft.operationalinsights/workspaces\\\"\\r\\n| project value = id, label = name, selected = false, group = resourceGroup\",\"crossComponentResources\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":[]}],\"style\":\"pills\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SqlAssessment_CL\\r\\n| extend parse_csv(RawData) // Raw Data is in CSV Format\\r\\n| project\\r\\n    TimeGenerated,\\r\\n    RuleId = RawData[2],\\r\\n    FullRuleName = RawData[3],\\r\\n    Description = RawData[4],\\r\\n    RuleUrl = RawData[5],\\r\\n    // 1 = Server, 2 = Database\\r\\n    Scope = case(\\r\\n        toint(RawData[6]) == 1, \\\"Server\\\", \\r\\n        toint(RawData[6]) == 2, \\\"Database\\\", \\r\\n        \\\"None\\\"\\r\\n    ), // 30 = High Sev, 20 = Medium, 10 = Low, 0 = Info, -1 = Ignore\\r\\n        Severity = case(\\r\\n        toint(RawData[8]) == 30, \\\"1 - High\\\", \\r\\n        toint(RawData[8]) == 20, \\\"2 - Medium\\\", \\r\\n        toint(RawData[8]) == 10, \\\"3 - Low\\\", \\r\\n        toint(RawData[8]) == -1, \\\"4 - Information\\\", \\r\\n        \\\"4 - Information\\\"\\r\\n    ),\\r\\n    Server = tostring(split(RawData[7], \\\":\\\")[0]), // Split this and just have null in database for server level items\\r\\n    Database = tostring(split(RawData[7], \\\":\\\")[1]),\\r\\n    InstanceName = RawData[11],\\r\\n    SuggestedAction = RawData[9],\\r\\n    Tags = RawData[10]\\r\\n| where Severity != \\\"4 - Information\\\"\\r\\n| summarize Findings = count() by Server, Severity\\r\\n| sort by Server, Severity asc\\r\\n| render columnchart \",\"size\":0,\"timeContext\":{\"durationMs\":604800000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{bpala}\"]},\"name\":\"query - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SqlAssessment_CL\\r\\n// Hard Code time to match how often you are running BPA assessments\\r\\n| where TimeGenerated >= ago(7d)\\r\\n// Raw Data is in CSV Format\\r\\n| extend parse_csv(RawData) \\r\\n| project\\r\\n    TimeGenerated,\\r\\n    RuleId = RawData[2],\\r\\n    FullRuleName = RawData[3],\\r\\n    Description = RawData[4],\\r\\n    RuleUrl = RawData[5],\\r\\n    // 1 = Server, 2 = Database\\r\\n    Scope = case(\\r\\n        toint(RawData[6]) == 1, \\\"Server\\\", \\r\\n        toint(RawData[6]) == 2, \\\"Database\\\", \\r\\n        \\\"None\\\"\\r\\n    ),\\r\\n    // 30 = High Sev, 20 = Medium, 10 = Low, 0 = Info, -1 = Ignore\\r\\n    Severity = case(\\r\\n        toint(RawData[8]) == 30, \\\"High\\\", \\r\\n        toint(RawData[8]) == 20, \\\"Medium\\\", \\r\\n        toint(RawData[8]) == 10, \\\"Low\\\", \\r\\n        toint(RawData[8]) == -1, \\\"Information\\\", \\r\\n        \\\"Information\\\"\\r\\n    ),\\r\\n    // Split this and just have null in database for server level items\\r\\n    Server = tostring(split(RawData[7], \\\":\\\")[0]),\\r\\n    Database = tostring(split(RawData[7], \\\":\\\")[1]),\\r\\n    InstanceName = RawData[11],\\r\\n    SuggestedAction = RawData[9],\\r\\n    Tags = RawData[10],\\r\\n    id = _ResourceId\\r\\n| where Severity != 'Information'\\r\\n| summarize Total = count(Severity), sevH=countif(Severity=='High'), sevM=countif(Severity=='Medium'), sevL=countif(Severity=='Low') by Server, id\",\"size\":0,\"timeContext\":{\"durationMs\":604800000},\"exportFieldName\":\"id\",\"exportParameterName\":\"sqlResource\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{bpala}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Server\",\"formatter\":1},{\"columnMatch\":\"Total\",\"formatter\":1},{\"columnMatch\":\"sevH\",\"formatter\":4,\"formatOptions\":{\"palette\":\"redBright\"}},{\"columnMatch\":\"sevM\",\"formatter\":4,\"formatOptions\":{\"palette\":\"yellow\"}},{\"columnMatch\":\"sevL\",\"formatter\":4,\"formatOptions\":{\"palette\":\"blue\"}}],\"labelSettings\":[{\"columnId\":\"id\",\"label\":\"Resource\"},{\"columnId\":\"sevH\",\"label\":\"High\"},{\"columnId\":\"sevM\",\"label\":\"Medium\"},{\"columnId\":\"sevL\",\"label\":\"Low\"}]}},\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SqlAssessment_CL\\r\\n// Raw Data is in CSV Format\\r\\n| extend parse_csv(RawData) \\r\\n| project\\r\\n    TimeGenerated,\\r\\n    RuleId = RawData[2],\\r\\n    FullRuleName = RawData[3],\\r\\n    Description = RawData[4],\\r\\n    RuleUrl = RawData[5],\\r\\n    // 1 = Server, 2 = Database\\r\\n    Scope = case(\\r\\n        toint(RawData[6]) == 1, \\\"Server\\\", \\r\\n        toint(RawData[6]) == 2, \\\"Database\\\", \\r\\n        \\\"None\\\"\\r\\n    ),\\r\\n    // 30 = High Sev, 20 = Medium, 10 = Low, 0 = Info, -1 = Ignore\\r\\n    Severity = case(\\r\\n        toint(RawData[8]) == 30, \\\"Sev1\\\", \\r\\n        toint(RawData[8]) == 20, \\\"Sev2\\\", \\r\\n        toint(RawData[8]) == 10, \\\"Sev3\\\", \\r\\n        toint(RawData[8]) == -1, \\\"Information\\\", \\r\\n        \\\"Information\\\"\\r\\n    ),\\r\\n    // Split this and just have null in database for server level items\\r\\n    Server = tostring(split(RawData[7], \\\":\\\")[0]),\\r\\n    Database = tostring(split(RawData[7], \\\":\\\")[1]),\\r\\n    InstanceName = RawData[11],\\r\\n    SuggestedAction = RawData[9],\\r\\n    Tags = RawData[10],\\r\\n    id = _ResourceId\\r\\n| where Severity != 'Information'\\r\\n| where '{sqlResource}' == 'All' or id == '{sqlResource}'\\r\\n| project Severity, id, InstanceName, Scope, FullRuleName, Description, RuleUrl, SuggestedAction\\r\\n| order by id, Severity asc\\r\\n\",\"size\":0,\"timeContext\":{\"durationMs\":604800000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{bpala}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"InstanceName\",\"formatter\":1},{\"columnMatch\":\"FullRuleName\",\"formatter\":1,\"formatOptions\":{\"linkColumn\":\"RuleUrl\",\"linkTarget\":\"Url\"}},{\"columnMatch\":\"RuleUrl\",\"formatter\":5},{\"columnMatch\":\"Severity\",\"formatter\":11}]}},\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SqlAssessment_CL\\r\\n// Raw Data is in CSV Format\\r\\n| extend parse_csv(RawData) \\r\\n| project\\r\\n    TimeGenerated,\\r\\n    RuleId = RawData[2],\\r\\n    FullRuleName = tostring(RawData[3]),\\r\\n    Description = RawData[4],\\r\\n    RuleUrl = tostring(RawData[5]),\\r\\n    // 1 = Server, 2 = Database\\r\\n    Scope = case(\\r\\n        toint(RawData[6]) == 1, \\\"Server\\\", \\r\\n        toint(RawData[6]) == 2, \\\"Database\\\", \\r\\n        \\\"None\\\"\\r\\n    ),\\r\\n    // 30 = High Sev, 20 = Medium, 10 = Low, 0 = Info, -1 = Ignore\\r\\n    Severity = case(\\r\\n        toint(RawData[8]) == 30, \\\"Sev1\\\", \\r\\n        toint(RawData[8]) == 20, \\\"Sev2\\\", \\r\\n        toint(RawData[8]) == 10, \\\"Sev3\\\", \\r\\n        toint(RawData[8]) == -1, \\\"Information\\\", \\r\\n        \\\"Information\\\"\\r\\n    ),\\r\\n    Weight = iff(toint(RawData[8]) > 1, toint(RawData[8]), 1),\\r\\n    // Split this and just have null in database for server level items\\r\\n    Server = tostring(split(RawData[7], \\\":\\\")[0]),\\r\\n    Database = tostring(split(RawData[7], \\\":\\\")[1]),\\r\\n    InstanceName = RawData[11],\\r\\n    SuggestedAction = RawData[9],\\r\\n    Tags = RawData[10],\\r\\n    id = _ResourceId\\r\\n| where Severity != 'Information'\\r\\n| where '{sqlResource}' == 'All' or id == '{sqlResource}'\\r\\n| project Severity, id, InstanceName, Scope, FullRuleName, Description, RuleUrl, SuggestedAction, Weight\\r\\n| summarize WeightedRanking = (count() * sum(Weight)) by Severity, Scope, FullRuleName, RuleUrl\\r\\n| order by WeightedRanking\\r\\n| project Severity, Scope, FullRuleName, RuleUrl\\r\\n\",\"size\":0,\"timeContext\":{\"durationMs\":604800000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{bpala}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"InstanceName\",\"formatter\":1},{\"columnMatch\":\"FullRuleName\",\"formatter\":1,\"formatOptions\":{\"linkColumn\":\"RuleUrl\",\"linkTarget\":\"Url\"}},{\"columnMatch\":\"RuleUrl\",\"formatter\":5},{\"columnMatch\":\"Severity\",\"formatter\":11}]}},\"name\":\"query - 3 - Copy\"}]},\"conditionalVisibility\":{\"parameterName\":\"View\",\"comparison\":\"isEqualTo\",\"value\":\"bpa\"},\"name\":\"bpa\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Licensing\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Arc SQL Databases By vCore Count\\r\\nresources\\r\\n|where type contains(\\\"microsoft.azurearcdata/sqlserverinstances\\\")\\r\\n|extend vCores =properties.vCore\\r\\n// Switched to container resource id to prevent instances getting counted as cores\\r\\n| extend ServerName = split(properties.containerResourceId, \\\"/\\\")[-1]\\r\\n| extend InstanceName =properties.instanceName\\r\\n|where vCores <>\\\"\\\"\\r\\n|project tostring(ServerName),toint(vCores)\\r\\n|order by vCores\",\"size\":0,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"],\"visualization\":\"barchart\"},\"customWidth\":\"50\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type == \\\"microsoft.azurearcdata/sqlserverinstances\\\" or type == \\\"microsoft.sqlvirtualmachine/sqlvirtualmachines\\\"\\r\\n| extend ServerName = tostring(coalesce(split(properties.virtualMachineResourceId, \\\"/\\\")[-1], split(properties.containerResourceId, \\\"/\\\")[-1]))\\r\\n| extend vmResourceId = tolower(tostring(properties.virtualMachineResourceId))\\r\\n| extend vCoresArc = toint(properties.vCore)\\r\\n| join kind = leftouter (\\r\\n    resources\\r\\n    | where type == \\\"microsoft.compute/virtualmachines\\\"\\r\\n    | extend vCoresArray = extract_all(\\\"([0-9])+\\\", tostring(properties.hardwareProfile.vmSize))\\r\\n    | project vmid = tolower(id), vCoresVm = iff(tostring(properties.hardwareProfile.vmSize) contains \\\"-\\\", toint(vCoresArray[1]), toint(vCoresArray[0]))\\r\\n)\\r\\non $left.vmResourceId == $right.vmid\\r\\n| extend vCores = coalesce(vCoresArc, vCoresVm)\\r\\n| extend SqlEdition = tostring(coalesce(properties.sqlImageSku, properties.edition))\\r\\n| distinct ServerName, vCores, SqlEdition\\r\\n| summarize sum(vCores) by SqlEdition\\r\\n| order by SqlEdition asc\",\"size\":0,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"],\"visualization\":\"barchart\"},\"customWidth\":\"50\",\"name\":\"query - 1\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"template\",\"loadFromTemplateId\":\"",
    "templatePart2": "\",\"items\":[]},\"name\":\"group - 2\"}]},\"conditionalVisibility\":{\"parameterName\":\"View\",\"comparison\":\"isEqualTo\",\"value\":\"licensing\"},\"name\":\"licensing\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Performance\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"f61b4acc-3496-40b9-89ef-7aea92249edc\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"vminsightsla\",\"label\":\"VM Insights Log Analytics Workspace\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"resources\\r\\n| where type == \\\"microsoft.operationalinsights/workspaces\\\"\\r\\n| project value = id, label = name, selected = false, group = resourceGroup\",\"crossComponentResources\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":[]},{\"id\":\"5419de50-6f1d-4da2-aa3d-a4be39d17a99\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"timerange\",\"label\":\"Time Range\",\"type\":4,\"isGlobal\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type == \\\"microsoft.azurearcdata/sqlserverinstances\\\"\\r\\n| extend ['id'] = tostring(properties.containerResourceId)\\r\\n| project id, name\",\"size\":1,\"title\":\"SQL Resources (Select SQL Servers to filter)\",\"exportMultipleValues\":true,\"exportedParameters\":[{\"fieldName\":\"id\",\"parameterName\":\"sqlResource\",\"parameterType\":5}],\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"]},\"name\":\"sqlitems\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let auto_bin_time = toscalar(InsightsMetrics\\r\\n| summarize MaxTime = max(TimeGenerated), MinTime = min(TimeGenerated)\\r\\n| extend TimeDiff = MaxTime - MinTime\\r\\n| project BinTime = case(\\r\\n    TimeDiff >= time(12h), timespan(5m),\\r\\n    TimeDiff >= time(2d), timespan(15m),\\r\\n    TimeDiff >= time(7d), timespan(30m),\\r\\n    TimeDiff >= time(30d), timespan(1h),\\r\\n    TimeDiff >= time(60d), timespan(6h),\\r\\n    TimeDiff >= time(120d), timespan(12h),\\r\\n    TimeDiff >= time(365d), timespan(24h),\\r\\n    timespan(1m)\\r\\n));\\r\\nlet sqlList = dynamic([{sqlResource}]);\\r\\nlet filteredMetrics = materialize(InsightsMetrics\\r\\n| where Name in ('UtilizationPercentage', 'AvailableMB', 'ReadBytesPerSecond', 'WriteBytesPerSecond', 'TransfersPerSecond')\\r\\n| where iff(array_length(sqlList) == 0, true, _ResourceId in~ (sqlList))\\r\\n| extend Computer = tostring(split(Computer, \\\".\\\", 0)[0])\\r\\n| summarize avg(Val) by _ResourceId, bin(TimeGenerated, auto_bin_time), Computer, Namespace, Name, Tags);\\r\\n\\r\\nfilteredMetrics\\r\\n| distinct _ResourceId, Computer, TimeGenerated\\r\\n| join kind = leftouter (\\r\\n    filteredMetrics\\r\\n    | where Name == 'UtilizationPercentage'\\r\\n    | extend cpuAvg = round(avg_Val, 2)\\r\\n    | project _ResourceId, cpuAvg, TimeGenerated\\r\\n)\\r\\non $left._ResourceId == $right._ResourceId and $left.TimeGenerated == $right.TimeGenerated\\r\\n| project-away _ResourceId1, TimeGenerated1\\r\\n| join kind = leftouter (\\r\\n    filteredMetrics\\r\\n    | where Name == 'AvailableMB'\\r\\n    | extend availMemMbAvg = avg_Val\\r\\n    | extend totalMemory = todouble(parse_json(Tags).['vm.azm.ms/memorySizeMB'])\\r\\n    | extend utilMemoryPercent = round((100 - (availMemMbAvg/totalMemory * 100)), 2), totalMemory = round(totalMemory)\\r\\n    | project _ResourceId, utilMemoryPercent, TimeGenerated\\r\\n)\\r\\non $left._ResourceId == $right._ResourceId and $left.TimeGenerated == $right.TimeGenerated\\r\\n| project-away _ResourceId1, TimeGenerated1\\r\\n| join kind = leftouter (\\r\\n    filteredMetrics\\r\\n    | where Namespace == \\\"Network\\\"\\r\\n    | where Name == 'ReadBytesPerSecond'\\r\\n    | summarize networkReadMbPerSecondAvg = round(sum(avg_Val)/1024/1024, 2) by _ResourceId, TimeGenerated\\r\\n)\\r\\non $left._ResourceId == $right._ResourceId and $left.TimeGenerated == $right.TimeGenerated\\r\\n| project-away _ResourceId1, TimeGenerated1\\r\\n| join kind = leftouter (\\r\\n    filteredMetrics\\r\\n    | where Namespace == \\\"Network\\\"\\r\\n    | where Name == 'WriteBytesPerSecond'\\r\\n    | summarize networkWriteMbPerSecondAvg = round(sum(avg_Val)/1024/1024, 2) by _ResourceId, TimeGenerated\\r\\n)\\r\\non $left._ResourceId == $right._ResourceId and $left.TimeGenerated == $right.TimeGenerated\\r\\n| project-away _ResourceId1, TimeGenerated1\\r\\n| join kind = leftouter (\\r\\n    filteredMetrics\\r\\n    | where Namespace == \\\"LogicalDisk\\\"\\r\\n    | where Name == \\\"ReadBytesPerSecond\\\" or Name == \\\"WriteBytesPerSecond\\\"\\r\\n    | extend throughputMBPerSecond = avg_Val/1024/1024\\r\\n    | summarize avgDiskThroughput = round(sum(throughputMBPerSecond), 2) by _ResourceId, TimeGenerated\\r\\n)\\r\\non $left._ResourceId == $right._ResourceId and $left.TimeGenerated == $right.TimeGenerated\\r\\n| project-away _ResourceId1, TimeGenerated1\\r\\n| join kind = leftouter (\\r\\n    filteredMetrics\\r\\n    | where Namespace == \\\"LogicalDisk\\\"\\r\\n    | where Name == \\\"TransfersPerSecond\\\"\\r\\n    | summarize avgDiskIops = round(sum(avg_Val)) by _ResourceId, TimeGenerated\\r\\n)\\r\\non $left._ResourceId == $right._ResourceId and $left.TimeGenerated == $right.TimeGenerated\\r\\n| project-away _ResourceId1, TimeGenerated1\",\"size\":0,\"timeContextFromParameter\":\"timerange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{vminsightsla}\"]},\"conditionalVisibility\":{\"parameterName\":\"View\",\"comparison\":\"isEqualTo\",\"value\":\"never\"},\"showPin\":false,\"name\":\"metricsQuery\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"Merge/1.0\\\",\\\"merges\\\":[{\\\"id\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75069\\\",\\\"mergeType\\\":\\\"innerunique\\\",\\\"leftTable\\\":\\\"sqlitems\\\",\\\"rightTable\\\":\\\"metricsQuery\\\",\\\"leftColumn\\\":\\\"id\\\",\\\"rightColumn\\\":\\\"_ResourceId\\\"}],\\\"projectRename\\\":[{\\\"originalName\\\":\\\"[metricsQuery].Computer\\\",\\\"mergedName\\\":\\\"Computer\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75069\\\"},{\\\"originalName\\\":\\\"[metricsQuery].TimeGenerated\\\",\\\"mergedName\\\":\\\"TimeGenerated\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75069\\\"},{\\\"originalName\\\":\\\"[metricsQuery].cpuAvg\\\",\\\"mergedName\\\":\\\"Cpu Utilization Percentage\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75069\\\"},{\\\"originalName\\\":\\\"[metricsQuery].avgDiskThroughput\\\"},{\\\"originalName\\\":\\\"[metricsQuery].networkWriteMbPerSecondAvg\\\"},{\\\"originalName\\\":\\\"[metricsQuery].networkReadMbPerSecondAvg\\\"},{\\\"originalName\\\":\\\"[metricsQuery].utilMemoryPercent\\\"},{\\\"originalName\\\":\\\"[metricsQuery]._ResourceId\\\"},{\\\"originalName\\\":\\\"[sqlitems].name\\\"},{\\\"originalName\\\":\\\"[sqlitems].id\\\"},{\\\"originalName\\\":\\\"[metricsQuery].avgDiskIops\\\"}]}\",\"size\":0,\"aggregation\":3,\"title\":\"CPU Utilization Percentage\",\"timeBrushParameterName\":\"timerange\",\"timeBrushExportOnlyWhenBrushed\":true,\"queryType\":7,\"visualization\":\"linechart\",\"chartSettings\":{\"group\":\"Computer\",\"createOtherGroup\":null,\"ySettings\":{\"min\":0,\"max\":100}}},\"customWidth\":\"50\",\"showPin\":false,\"name\":\"Cpu Percentage\",\"styleSettings\":{\"padding\":\"5px\",\"maxWidth\":\"50%\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"Merge/1.0\\\",\\\"merges\\\":[{\\\"id\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a7506f\\\",\\\"mergeType\\\":\\\"innerunique\\\",\\\"leftTable\\\":\\\"sqlitems\\\",\\\"rightTable\\\":\\\"metricsQuery\\\",\\\"leftColumn\\\":\\\"id\\\",\\\"rightColumn\\\":\\\"_ResourceId\\\"}],\\\"projectRename\\\":[{\\\"originalName\\\":\\\"[metricsQuery].Computer\\\",\\\"mergedName\\\":\\\"Computer\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a7506f\\\"},{\\\"originalName\\\":\\\"[metricsQuery].TimeGenerated\\\",\\\"mergedName\\\":\\\"TimeGenerated\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a7506f\\\"},{\\\"originalName\\\":\\\"[metricsQuery].utilMemoryPercent\\\",\\\"mergedName\\\":\\\"Memory Utilization Percentage\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a7506f\\\"},{\\\"originalName\\\":\\\"[sqlitems].id\\\"},{\\\"originalName\\\":\\\"[sqlitems].name\\\"},{\\\"originalName\\\":\\\"[metricsQuery]._ResourceId\\\"},{\\\"originalName\\\":\\\"[metricsQuery].cpuAvg\\\"},{\\\"originalName\\\":\\\"[metricsQuery].networkReadMbPerSecondAvg\\\"},{\\\"originalName\\\":\\\"[metricsQuery].networkWriteMbPerSecondAvg\\\"},{\\\"originalName\\\":\\\"[metricsQuery].avgDiskThroughput\\\"},{\\\"originalName\\\":\\\"[metricsQuery].avgDiskIops\\\"}]}\",\"size\":0,\"aggregation\":3,\"title\":\"Memory Utilization Percentage\",\"timeBrushParameterName\":\"timerange\",\"timeBrushExportOnlyWhenBrushed\":true,\"queryType\":7,\"visualization\":\"linechart\",\"chartSettings\":{\"group\":\"Computer\",\"createOtherGroup\":null,\"ySettings\":{\"min\":0,\"max\":100}}},\"customWidth\":\"50\",\"showPin\":false,\"name\":\"Memory Percentage\",\"styleSettings\":{\"padding\":\"5px\",\"maxWidth\":\"50%\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"Merge/1.0\\\",\\\"merges\\\":[{\\\"id\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75070\\\",\\\"mergeType\\\":\\\"innerunique\\\",\\\"leftTable\\\":\\\"sqlitems\\\",\\\"rightTable\\\":\\\"metricsQuery\\\",\\\"leftColumn\\\":\\\"id\\\",\\\"rightColumn\\\":\\\"_ResourceId\\\"}],\\\"projectRename\\\":[{\\\"originalName\\\":\\\"[metricsQuery].Computer\\\",\\\"mergedName\\\":\\\"Computer\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75070\\\"},{\\\"originalName\\\":\\\"[metricsQuery].TimeGenerated\\\",\\\"mergedName\\\":\\\"TimeGenerated\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75070\\\"},{\\\"originalName\\\":\\\"[metricsQuery].avgDiskThroughput\\\",\\\"mergedName\\\":\\\"Disk Throughput in MBps\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75070\\\"},{\\\"originalName\\\":\\\"[sqlitems].id\\\"},{\\\"originalName\\\":\\\"[sqlitems].name\\\"},{\\\"originalName\\\":\\\"[metricsQuery]._ResourceId\\\"},{\\\"originalName\\\":\\\"[metricsQuery].cpuAvg\\\"},{\\\"originalName\\\":\\\"[metricsQuery].utilMemoryPercent\\\"},{\\\"originalName\\\":\\\"[metricsQuery].networkReadMbPerSecondAvg\\\"},{\\\"originalName\\\":\\\"[metricsQuery].networkWriteMbPerSecondAvg\\\"},{\\\"originalName\\\":\\\"[metricsQuery].avgDiskIops\\\"}]}\",\"size\":0,\"aggregation\":3,\"title\":\"Disk Throughput in MBps\",\"timeBrushParameterName\":\"timerange\",\"timeBrushExportOnlyWhenBrushed\":true,\"queryType\":7,\"visualization\":\"linechart\",\"chartSettings\":{\"group\":\"Computer\",\"createOtherGroup\":null}},\"customWidth\":\"50\",\"showPin\":false,\"name\":\"Disk Throughput\",\"styleSettings\":{\"padding\":\"5px\",\"maxWidth\":\"50%\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"Merge/1.0\\\",\\\"merges\\\":[{\\\"id\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75071\\\",\\\"mergeType\\\":\\\"innerunique\\\",\\\"leftTable\\\":\\\"sqlitems\\\",\\\"rightTable\\\":\\\"metricsQuery\\\",\\\"leftColumn\\\":\\\"id\\\",\\\"rightColumn\\\":\\\"_ResourceId\\\"}],\\\"projectRename\\\":[{\\\"originalName\\\":\\\"[metricsQuery].Computer\\\",\\\"mergedName\\\":\\\"Computer\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75071\\\"},{\\\"originalName\\\":\\\"[metricsQuery].avgDiskIops\\\",\\\"mergedName\\\":\\\"Disk IOPS\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75071\\\"},{\\\"originalName\\\":\\\"[metricsQuery].TimeGenerated\\\",\\\"mergedName\\\":\\\"TimeGenerated\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75071\\\"},{\\\"originalName\\\":\\\"[sqlitems].id\\\"},{\\\"originalName\\\":\\\"[sqlitems].name\\\"},{\\\"originalName\\\":\\\"[metricsQuery].cpuAvg\\\"},{\\\"originalName\\\":\\\"[metricsQuery].utilMemoryPercent\\\"},{\\\"originalName\\\":\\\"[metricsQuery].networkReadMbPerSecondAvg\\\"},{\\\"originalName\\\":\\\"[metricsQuery].networkWriteMbPerSecondAvg\\\"},{\\\"originalName\\\":\\\"[metricsQuery].avgDiskThroughput\\\"},{\\\"originalName\\\":\\\"[metricsQuery]._ResourceId\\\"}]}\",\"size\":0,\"aggregation\":3,\"title\":\"Disk IOPS\",\"timeBrushParameterName\":\"timerange\",\"timeBrushExportOnlyWhenBrushed\":true,\"queryType\":7,\"visualization\":\"linechart\",\"chartSettings\":{\"group\":\"Computer\",\"createOtherGroup\":null}},\"customWidth\":\"50\",\"showPin\":false,\"name\":\"Disk IOPS\",\"styleSettings\":{\"padding\":\"5px\",\"maxWidth\":\"50%\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"Merge/1.0\\\",\\\"merges\\\":[{\\\"id\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75071\\\",\\\"mergeType\\\":\\\"innerunique\\\",\\\"leftTable\\\":\\\"sqlitems\\\",\\\"rightTable\\\":\\\"metricsQuery\\\",\\\"leftColumn\\\":\\\"id\\\",\\\"rightColumn\\\":\\\"_ResourceId\\\"}],\\\"projectRename\\\":[{\\\"originalName\\\":\\\"[metricsQuery].Computer\\\",\\\"mergedName\\\":\\\"Computer\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75071\\\"},{\\\"originalName\\\":\\\"[metricsQuery].TimeGenerated\\\",\\\"mergedName\\\":\\\"TimeGenerated\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75071\\\"},{\\\"originalName\\\":\\\"[metricsQuery].networkReadMbPerSecondAvg\\\",\\\"mergedName\\\":\\\"Network Read Throughput in MBps\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75071\\\"},{\\\"originalName\\\":\\\"[metricsQuery].avgDiskIops\\\"},{\\\"originalName\\\":\\\"[sqlitems].id\\\"},{\\\"originalName\\\":\\\"[sqlitems].name\\\"},{\\\"originalName\\\":\\\"[metricsQuery]._ResourceId\\\"},{\\\"originalName\\\":\\\"[metricsQuery].cpuAvg\\\"},{\\\"originalName\\\":\\\"[metricsQuery].utilMemoryPercent\\\"},{\\\"originalName\\\":\\\"[metricsQuery].networkWriteMbPerSecondAvg\\\"},{\\\"originalName\\\":\\\"[metricsQuery].avgDiskThroughput\\\"}]}\",\"size\":0,\"aggregation\":3,\"title\":\"Network Read Throughput in MBps\",\"timeBrushParameterName\":\"timerange\",\"timeBrushExportOnlyWhenBrushed\":true,\"queryType\":7,\"visualization\":\"linechart\",\"chartSettings\":{\"group\":\"Computer\",\"createOtherGroup\":null}},\"customWidth\":\"50\",\"showPin\":false,\"name\":\"Network Read Throughput in MBps\",\"styleSettings\":{\"padding\":\"5px\",\"maxWidth\":\"50%\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"Merge/1.0\\\",\\\"merges\\\":[{\\\"id\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75071\\\",\\\"mergeType\\\":\\\"innerunique\\\",\\\"leftTable\\\":\\\"sqlitems\\\",\\\"rightTable\\\":\\\"metricsQuery\\\",\\\"leftColumn\\\":\\\"id\\\",\\\"rightColumn\\\":\\\"_ResourceId\\\"}],\\\"projectRename\\\":[{\\\"originalName\\\":\\\"[metricsQuery].Computer\\\",\\\"mergedName\\\":\\\"Computer\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75071\\\"},{\\\"originalName\\\":\\\"[metricsQuery].TimeGenerated\\\",\\\"mergedName\\\":\\\"TimeGenerated\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75071\\\"},{\\\"originalName\\\":\\\"[metricsQuery].networkWriteMbPerSecondAvg\\\",\\\"mergedName\\\":\\\"networkWriteMbPerSecondAvg\\\",\\\"fromId\\\":\\\"7c42448a-46dc-4e97-b391-8286f1a75071\\\"},{\\\"originalName\\\":\\\"[metricsQuery].networkReadMbPerSecondAvg\\\"},{\\\"originalName\\\":\\\"[sqlitems].id\\\"},{\\\"originalName\\\":\\\"[sqlitems].name\\\"},{\\\"originalName\\\":\\\"[metricsQuery]._ResourceId\\\"},{\\\"originalName\\\":\\\"[metricsQuery].cpuAvg\\\"},{\\\"originalName\\\":\\\"[metricsQuery].utilMemoryPercent\\\"},{\\\"originalName\\\":\\\"[metricsQuery].avgDiskThroughput\\\"},{\\\"originalName\\\":\\\"[metricsQuery].avgDiskIops\\\"}]}\",\"size\":0,\"aggregation\":3,\"title\":\"Network Write Throughput in MBps\",\"timeBrushParameterName\":\"timerange\",\"timeBrushExportOnlyWhenBrushed\":true,\"queryType\":7,\"visualization\":\"linechart\",\"chartSettings\":{\"group\":\"Computer\",\"createOtherGroup\":null}},\"customWidth\":\"50\",\"showPin\":false,\"name\":\"Network Write Throughput in MBps\",\"styleSettings\":{\"padding\":\"5px\",\"maxWidth\":\"50%\"}}]},\"conditionalVisibility\":{\"parameterName\":\"View\",\"comparison\":\"isEqualTo\",\"value\":\"perf\"},\"name\":\"perf\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Security\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\r\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\r\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1,  id)\\r\\n| where assessmentKey == \\\"f97aa83c-9b63-4f9a-99f6-b22c4398f936\\\" or assessmentKey == \\\"82e20e14-edc5-4373-bfc4-f13121257c37\\\"\\r\\n | project id = tolower(extract(\\\"([\\\\\\\\s\\\\\\\\S]*?)(/providers/Microsoft.Security.*)\\\",1,id)), subscriptionId, severity = tostring(parse_json(properties).status.severity), status = tostring(parse_json(properties).status.code), VulnId = tostring(parse_json(properties).id)\\r\\n | where status == 'Unhealthy'\\r\\n  | extend icon = case(severity == \\\"High\\\", \\\"Sev1\\\", severity == \\\"Medium\\\", \\\"Sev2\\\", severity == \\\"Low\\\", \\\"Sev3\\\", \\\"None\\\")\\r\\n | extend severity = case(severity == \\\"High\\\", \\\"1 - High\\\", severity == \\\"Medium\\\", \\\"2 - Medium\\\", severity == \\\"Low\\\", \\\"3 - Low\\\", \\\"None\\\")\\r\\n | summarize count() by severity, icon\\r\\n | order by severity asc\",\"size\":4,\"title\":\"SQL Vulnerabilities Found\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"severity\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"none\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"rightContent\":{\"columnMatch\":\"icon\",\"formatter\":11},\"showBorder\":false,\"sortCriteriaField\":\"severity\",\"sortOrderField\":1,\"size\":\"auto\"}},\"name\":\"query - 0\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"template\",\"loadFromTemplateId\":\"community-Workbooks/Azure Security Center/Vulnerabilities\",\"items\":[]},\"name\":\"group - 1\"}]},\"conditionalVisibility\":{\"parameterName\":\"View\",\"comparison\":\"isEqualTo\",\"value\":\"security\"},\"name\":\"Security\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Backups\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type == \\\"microsoft.azurearcdata/sqlserverinstances/databases\\\"\\r\\n| extend recoveryMode = tostring(properties.recoveryMode)\\r\\n| extend lastFullBackup = todatetime(properties.backupInformation.lastFullBackup)\\r\\n| extend lastLogBackup = todatetime(properties.backupInformation.lastLogBackup)\\r\\n| extend daysSinceFullBackup = datetime_diff('day', now(), lastFullBackup)\\r\\n| extend hoursSinceLogBackup = datetime_diff('hour', now(), lastLogBackup)\\r\\n| extend fullBackupStatus = iif(isnull(lastFullBackup), \\\"Critical\\\", \\r\\n                            case(daysSinceFullBackup <= 7, \\\"Healthy\\\",\\r\\n                                daysSinceFullBackup <= 30, \\\"Warning\\\",\\r\\n                                \\\"Critical\\\"))\\r\\n| summarize count() by fullBackupStatus\",\"size\":0,\"title\":\"Full Backup Status\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"],\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Warning\",\"color\":\"yellowDark\"},{\"seriesName\":\"Healthy\",\"color\":\"green\"}]}},\"customWidth\":\"50\",\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type == \\\"microsoft.azurearcdata/sqlserverinstances/databases\\\"\\r\\n| extend recoveryMode = tostring(properties.recoveryMode)\\r\\n| extend lastFullBackup = todatetime(properties.backupInformation.lastFullBackup)\\r\\n| extend lastLogBackup = todatetime(properties.backupInformation.lastLogBackup)\\r\\n| extend daysSinceFullBackup = datetime_diff('day', now(), lastFullBackup)\\r\\n| extend hoursSinceLogBackup = datetime_diff('hour', now(), lastLogBackup)\\r\\n| extend logBackupStatus = iif(recoveryMode == \\\"Simple\\\", \\r\\n                            \\\"none\\\",\\r\\n                            iif(isnull(lastLogBackup), \\\"Critical\\\", \\r\\n                            case(hoursSinceLogBackup <= 24, \\\"Healthy\\\",\\r\\n                                hoursSinceLogBackup <= 168, \\\"Warning\\\",\\r\\n                                \\\"Critical\\\"))\\r\\n                            )\\r\\n| where logBackupStatus != \\\"none\\\"\\r\\n| summarize count() by logBackupStatus\",\"size\":0,\"title\":\"Log Backup Status\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"],\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Warning\",\"color\":\"yellowDark\"},{\"seriesName\":\"Healthy\",\"color\":\"green\"}]}},\"customWidth\":\"50\",\"name\":\"query - 2 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type == \\\"microsoft.azurearcdata/sqlserverinstances/databases\\\"\\r\\n| extend recoveryMode = tostring(properties.recoveryMode)\\r\\n| extend lastFullBackup = todatetime(properties.backupInformation.lastFullBackup)\\r\\n| extend lastLogBackup = todatetime(properties.backupInformation.lastLogBackup)\\r\\n| extend daysSinceFullBackup = datetime_diff('day', now(), lastFullBackup)\\r\\n| extend hoursSinceLogBackup = datetime_diff('hour', now(), lastLogBackup)\\r\\n| extend fullBackupStatus = iif(isnull(lastFullBackup), \\\"critical\\\", \\r\\n                            case(daysSinceFullBackup <= 7, \\\"success\\\",\\r\\n                                daysSinceFullBackup <= 30, \\\"warning\\\",\\r\\n                                \\\"critical\\\"))\\r\\n| extend logBackupStatus = iif(recoveryMode == \\\"Simple\\\", \\r\\n                            \\\"none\\\",\\r\\n                            iif(isnull(lastLogBackup), \\\"critical\\\", \\r\\n                            case(hoursSinceLogBackup <= 24, \\\"success\\\",\\r\\n                                hoursSinceLogBackup <= 168, \\\"warning\\\",\\r\\n                                \\\"critical\\\"))\\r\\n                            )\\r\\n| extend arcEnabledSqlId = tostring(split(id, \\\"/Databases\\\")[0])\\r\\n| project id, arcEnabledSqlId, recoveryMode, lastFullBackup, fullBackupStatus, lastLogBackup, logBackupStatus\\r\\n| order by id, arcEnabledSqlId\",\"size\":0,\"title\":\"Detailed Backup Status\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"lastFullBackup\",\"formatter\":6},{\"columnMatch\":\"fullBackupStatus\",\"formatter\":11},{\"columnMatch\":\"lastLogBackup\",\"formatter\":6},{\"columnMatch\":\"logBackupStatus\",\"formatter\":11}]}},\"name\":\"query - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type == \\\"microsoft.hybridcompute/machines/extensions\\\"\\r\\n| where name == \\\"WindowsAgent.SqlServer\\\"\\r\\n| extend status = properties.instanceView.status.message\\r\\n| extend AutomaticBackupsEnabled = iif(status contains \\\"AutomaticBackups: Running;\\\" and status !contains \\\"SqlAgentPlugin: null,\\\", true, false)\\r\\n// some magic strings to get the Sql Backup data out, really not the best way to do this, but I can't think of a better option at the moment, regex maybe?\\r\\n// actually even regex is still magic strings, but makes it a single operation instead of multiple splits\\r\\n| extend backupSettings = parse_json(extract(\\\"(SqlAgentPlugin: )(.*)(, DatabaseMonitorArcPlugin)\\\", 2, tostring(status)))\\r\\n| extend retentionPeriodInDays = iif(array_length(backupSettings.profiles.['$values']) == 0, toint(backupSettings.retentionPeriodInDays), int(null))\\r\\n| extend backupSettings = iif(array_length(backupSettings.profiles.['$values']) == 0, dynamic(null), backupSettings)\\r\\n| mv-expand backupSettings.profiles.['$values']\\r\\n| extend backupSettings = ['backupSettings_profiles_$values']\\r\\n| where isnull(backupSettings) or backupSettings.enabled == true\\r\\n| extend retentionPeriodInDays = iif(isnull(retentionPeriodInDays), toint(backupSettings.retentionPeriodInDays), retentionPeriodInDays),\\r\\n         fullBackupDays = toint(backupSettings.fullBackupDays), \\r\\n         differentialBackupHours = toint(backupSettings.differentialBackupHours), \\r\\n         tLogBackupMinutes = toint(backupSettings.tLogBackupMinutes)\\r\\n| extend arcId = tolower(tostring(split(id, \\\"/extensions\\\")[0]))\\r\\n| join kind = leftouter (\\r\\n    resources\\r\\n    | where type == \\\"microsoft.azurearcdata/sqlserverinstances\\\"\\r\\n    | extend containerId = tolower(tostring(properties.containerResourceId))\\r\\n    | project sqlId = tostring(id), containerId\\r\\n)\\r\\non $left.arcId == $right.containerId\\r\\n| extend AutomaticBackupsEnabled = iif(AutomaticBackupsEnabled, \\\"success\\\", \\\"disabled\\\")\\r\\n| project id = sqlId, AutomaticBackupsEnabled, retentionPeriodInDays, fullBackupDays, differentialBackupHours, tLogBackupMinutes\\r\\n| order by AutomaticBackupsEnabled desc \",\"size\":0,\"title\":\"Automatic Backup Settings\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"id\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"AutomaticBackupsEnabled\",\"formatter\":11}]}},\"name\":\"query - 0\"}]},\"conditionalVisibility\":{\"parameterName\":\"View\",\"comparison\":\"isEqualTo\",\"value\":\"backups\"},\"name\":\"Backups\"}],\"isLocked\":false,\"fallbackResourceIds\":[\"azure monitor\"]}",
    "workbookTemplate": "[concat(variables('templatePart1'), parameters('licensingWorkbookId'), variables('templatePart2'))]"
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2022-04-01",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "[variables('workbookTemplate')]",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"
}